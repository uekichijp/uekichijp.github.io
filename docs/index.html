<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kamatamare Matchday Voice — TTS</title>
<style>
  body{font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif;max-width:880px;margin:40px auto;padding:0 16px}
  textarea,input,button{width:100%;font-size:16px} textarea{height:220px}
  .row{margin:12px 0}.mono{font-family:ui-monospace,Menlo,monospace}
</style>
<h1>Matchday Voice — Text → MP3</h1>

<div class="row">
  <label>Text</label>
  <textarea id="text" placeholder="Paste narration here…"></textarea>
</div>
<div class="row">
  <label>Output file basename (no extension)</label>
  <input id="basename" placeholder="mdv_2025-08-xx_fc-osaka">
</div>
<div class="row"><button id="run">Generate MP3</button></div>

<div class="row mono" id="log"></div>
<audio id="player" controls style="width:100%;display:none;margin-top:12px"></audio>

<script>
const API_URL = "https://xfu2hcm7ef.execute-api.ap-northeast-1.amazonaws.com/synthesize"; // ←あなたのURL

const elText = document.getElementById("text");
const elBase = document.getElementById("basename");
const elLog  = document.getElementById("log");
const elPlayer = document.getElementById("player");

function log(msg){ elLog.innerText = msg; }

document.getElementById("run").addEventListener("click", async () => {
  const text = elText.value.trim();
  if(!text){ return log("⚠️ text が空です"); }
  const file_basename = (elBase.value.trim() || ("mdv_" + Date.now()));
  log("Processing…");

  try {
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ text, file_basename })
    });
    const bodyText = await res.text();      // ← エラー時の本文も見たいので先にtextで取る
    if (!res.ok) throw new Error(`HTTP ${res.status} ${bodyText}`);

    const data = JSON.parse(bodyText);
    const url = data.presigned_url;
    log(`✅ S3 saved: ${data.s3_key}\nvoice=${data.voice}, engine=${data.engine}\nchunks=${data.chunks}`);
    elPlayer.src = url; elPlayer.style.display = "block"; elPlayer.play().catch(()=>{});
  } catch (e) {
    log("❌ Error: " + e.message);
  }
});
</script>
</html>
